#!/usr/bin/env python
# -*- coding: utf-8 -*-
# Author: Christian Brodbeck <christianbrodbeck@nyu.edu>
import argparse
from zoterocleanup import merge_authors, check_for_missing_dois, remove_notes
from zoterocleanup._notes import AUTO_TOC_START


# create the top-level parser
parser = argparse.ArgumentParser()
subparsers = parser.add_subparsers(help='sub-command help')

# author-names
subparser = subparsers.add_parser(
    'merge-authors',
    help='Find author names that seem to be different spellings of the same '
         'author. ')
subparser.set_defaults(
    func=lambda a: merge_authors())

# journal abbreviations
# subparser = subparsers.add_parser('abbr')
# subparser.add_argument('command', help=" | journal-abbr")

# DOIs
subparser = subparsers.add_parser(
    'doi',
    help='Check for missing DOIs')
subparser.set_defaults(
    func=lambda a: check_for_missing_dois())

# notes
subparser = subparsers.add_parser(
    'remove-notes',
    help='Remove notes matchin a given pattern from attachments. The default '
         'is to remove auto-generated ')
subparser.add_argument(
    '-q', '--quiet',
    dest='verbose',
    action='store_false',
    help="Don't print the content of the matching notes")
subparser.add_argument(
    '-p', '--pattern',
    default=AUTO_TOC_START,
    help="Pattern to match notes")
subparser.set_defaults(
    func=lambda a: remove_notes(a.verbose, a.pattern))

# parse and execute
args = parser.parse_args()
args.func(args)
